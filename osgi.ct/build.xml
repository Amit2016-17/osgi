<?xml version="1.0" encoding="UTF-8"?>
<project name="project" default="publish">
	<import file="../cnf/build.xml" />

	<target name="runtests" depends="init">
		<antcall target="-runtest">
			<param name="test-name" value="osgi.core.tests" />
			<param name="jars" value="../osgi.ri/generated/osgi.core.impls.jar" />
		</antcall>

		<antcall target="-runtest">
			<param name="test-name" value="osgi.cmpn.tests" />
			<param name="jars" value="${workspace}/osgi.ri/generated/osgi.core.impls.jar,${workspace}/osgi.ri/generated/osgi.core.impls.jar" />
		</antcall>
	</target>

	<target name="-runtest">
		<property name="prefix" value="${target}/${test-name}" />
		<delete dir="${prefix}" />
		<mkdir dir="${prefix}" />
		<unzip dest="${prefix}" src="${prefix}.jar" />
		<for list="${jars}" param="jar">
			<sequential>
				<echo>Proc @{jar} </echo>
		        <unzip dest="${prefix}/jar" src="@{jar}" />
			</sequential>
		</for>
		<java dir="${prefix}" jar="${prefix}/jar/bnd.jar" fork="true">
			<arg value="-exceptions" />
			<arg value="runtests" />
			<arg value="-title" />
			<arg value="${test-name}" />
		</java>
	</target>
</project>
