<?xml version="1.0" encoding="UTF-8"?>
<project name="test" default="help">
	<target name="help">
		<fail>
			Compliance test execution file for the OSGi build.
			This file is not meant for direct execution on the developers workstation.
			It is also used by the compliance test execution on hudson.
		</fail>
	</target>

	<target name="init" unless="initialized" depends="-target-dir,-project.workspace">
		<property name="ct-dir" value="${project.workspace}/osgi.ct/${target-dir}/${test-name}" />
		<!-- mark init has been run -->
		<property name="initialized" value="set" />
	</target>
	
	<target name="-target-dir" unless="target-dir">
		<property name="target-dir" value="generated" />
	</target>
	
	<target name="-project.workspace" unless="project.workspace">
		<dirname property="-projectdir" file="${ant.file}" />
		<dirname property="project.workspace" file="${-projectdir}" />
	</target>

	<target name="install" depends="init">
		<delete dir="${ct-dir}" />
		<unzip dest="${ct-dir}">
			<fileset dir="${project.workspace}/osgi.ri/${target-dir}" includes="${ri-jars}" />
			<patternset includes="**/*.jar"/>
		</unzip>
		<unzip dest="${ct-dir}">
			<fileset dir="${project.workspace}/osgi.ct/${target-dir}" includes="${test-name}.jar" />
		</unzip>
	</target>

	<target name="test" depends="install">
		<java dir="${ct-dir}" jar="${ct-dir}/jar/bnd.jar" fork="true">
			<arg value="-exceptions" />
			<arg value="runtests" />
			<arg value="-title" />
			<arg value="${test-name}" />
		</java>
	</target>
	
</project>
