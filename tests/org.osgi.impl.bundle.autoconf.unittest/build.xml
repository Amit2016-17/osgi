<?xml version="1.0" encoding="UTF-8"?>
<project name="project" default="publish"> 
	<import file="../cnf/build.xml"/>
	
	<target name="generate-binding">
		<path id="generate.class.path">
			<pathelement location="jaxme/jaxme2.jar"/>
			<pathelement location="jaxme/jaxmejs.jar"/>
			<pathelement location="jaxme/jaxmexs.jar"/>
			<pathelement location="jaxme/jaxmeapi.jar"/>
		</path>
		<taskdef name="xjc"
	        classname="org.apache.ws.jaxme.generator.XJCTask"
	        classpathref="generate.class.path"/>
		<xjc 
	        schema="../org.osgi.impl.bundle.autoconf/src/org/osgi/impl/bundle/autoconf/autoconf.xsd" 
	        target="src"
	      	package="unittests.metadata">
		</xjc>
	</target>
	<target name="compile" depends="generate-binding,master.compile"/>
	<target name="clean" depends="master.clean">
		<delete dir="${project}/src/unittests/metadata" verbose="$verbose" quiet="true"/>
	</target>

	<target name="deploymentpackages" depends="integrationtests.managedservice1.jar">
		<jar destfile="integrationtests.dp1.jar">
			<manifest>
				<attribute name="DeploymentPackage-Name" value="integrationtests.dp1"/>
				<attribute name="DeploymentPackage-Version" value="1.0.0"/>
				<section name="integrationtests.managedservice1.jar">
					<attribute name="Bundle-SymbolicName" value="integrationtests.managedservice1"/>
					<attribute name="Bundle-Version" value="1.0"/>
				</section>
				<section name="OSGI-INF/autoconf.xml">
					<attribute name="Resource-Processor" value="org.osgi.deployment.config_resource_processor"/>
				</section>
			</manifest>
			<fileset dir=".">
				<filename name="integrationtests.managedservice1.jar"/>
			</fileset>
			<fileset dir="configs/dp1"/>
		</jar>
		<signjar jar="integrationtests.dp1.jar" alias="sarahbar" 
			keystore="../org.osgi.impl.service.policy.unittest/integration_test/keystore" storepass="123456"/>

		<jar destfile="integrationtests.dp1_rollback.jar">
			<manifest>
				<attribute name="DeploymentPackage-Name" value="integrationtests.dp1"/>
				<attribute name="DeploymentPackage-Version" value="1.0.0"/>
				<section name="integrationtests.managedservice1.jar">
					<attribute name="Bundle-SymbolicName" value="integrationtests.managedservice1"/>
					<attribute name="Bundle-Version" value="1.0"/>
				</section>
				<section name="OSGI-INF/autoconf.xml">
					<attribute name="Resource-Processor" value="org.osgi.deployment.config_resource_processor"/>
				</section>
			</manifest>
			<fileset dir=".">
				<filename name="integrationtests.managedservice1.jar"/>
			</fileset>
			<fileset dir="configs/dp1_rollback"/>
		</jar>
		<signjar jar="integrationtests.dp1_rollback.jar" alias="sarahbar" 
			keystore="../org.osgi.impl.service.policy.unittest/integration_test/keystore" storepass="123456"/>
	</target>

	<target name="integrationtests.managedservice1.jar">
		<jar destfile="integrationtests.managedservice1.jar">
			<manifest>
				<attribute name="Service-Component" value="OSGI-INF/managedservice1.xml"/>
				<attribute name="Bundle-Name" value="IntegrationTestManagedService1"/>
				<attribute name="Private-Package" value="OSGI-INF, OSGI-INF.metatype, integrationtests.managedservice1"/>
				<attribute name="Import-Package" value="integrationtests.api, org.osgi.service.cm, org.osgi.service.component"/>
				<attribute name="Bundle-Vendor" value="Nokia"/>
				<attribute name="Bundle-SymbolicName" value="integrationtests.managedservice1"/>
				<attribute name="Bundle-Version" value="1.0"/>
			</manifest>
			<fileset dir="src" includes="integrationtests/managedservice1/**"/>
			<fileset dir="configs/integrationtests.managedservice1"/>
		</jar>
		<signjar jar="integrationtests.managedservice1.jar" alias="sarahbar" 
			keystore="../org.osgi.impl.service.policy.unittest/integration_test/keystore" storepass="123456"/>
	</target>
	
	<target name="jars" depends="master.jars,deploymentpackages"/>

</project>
