<?xml version="1.0" encoding="UTF-8"?>
<project name="project" default="director">
	
	<target name="clean">
		<delete> <!-- delete bundles dir to clear permdata -->
			<fileset dir="configuration">
				<exclude name="config.ini"/>
			</fileset>
		</delete>
	</target>	
	
	<target name="director" depends="clean">
		<java fork="true" jar="../org.osgi.impl.framework.eclipse.jar">	
			<jvmarg value="-Dosgi.install.area=file:"/>
			<jvmarg value="-Dosgi.bundles=osgi.jar@start,servlet.jar@start,osgi.min.jar@start,osgi.director.jar@start"/>
		</java>
	</target>
		
	<target name="run-cmpn">
		<ant target="-run">
			<property name="tests" value="osgi.cmpn.tests.jar@start"/>
			<property name="script" value="file:cmpn.script"/>
			<property name="out" value="run-cmpn.xml"/>
		</ant>
	</target>
	
	<target name="run-core">
		<antcall target="-run">
			<param name="tests" value="osgi.core.tests.jar@start"/>
			<param name="script" value="file:core.script"/>
			<param name="out" value="run-core.xml"/>
		</antcall>
	</target>
	
	<target name="run-mobile">
		<ant target="-run">
			<property name="tests" value="osgi.mobile.tests.jar@start"/>
			<property name="script" value="file:mobile.script"/>
			<property name="out" value="run-mobile.xml"/>
		</ant>
	</target>
	
	<target name="run-link">
		<antcall target="-run">
			<param name="tests" value="org.osgi.test.cases.testtool.jar@start"/>
			<param name="script" value="file:link.script"/>
			<param name="out" value="run-link.xml"/>
		</antcall>
	</target>
	
	<target name="-run" depends="clean">		
		<java fork="true" jar="../org.osgi.impl.framework.eclipse.jar">	
			<jvmarg value="-Dorg.osgi.test.batch.script=${script}"/>
			<jvmarg value="-Dorg.osgi.test.batch.out=${out}"/>
			<jvmarg value="-Dosgi.install.area=file:"/>
			<jvmarg value="-Dosgi.bundles=osgi.jar@start,servlet.jar@start,osgi.min.jar@start,osgi.director.jar@start,${tests}"/>
		</java>
	</target>
</project>
