<?xml version="1.0" encoding="utf-8"?>
<chapter label="703"
         revision="$Id$"
         version="5" xml:id="util.position"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:ns5="http://www.w3.org/2000/svg"
         xmlns:ns4="http://www.w3.org/1998/Math/MathML"
         xmlns:ns3="http://www.w3.org/1999/xhtml"
         xmlns:ns="http://docbook.org/ns/docbook">
  <title>Position Specification</title>

  <info>
    <releaseinfo><xref endterm="org.osgi.util.position-version"
    linkend="org.osgi.util.position" xrefstyle="Heading"/></releaseinfo>
  </info>

  <section>
    <title>Introduction</title>

    <para>The <code>Position</code> class is a utility providing bundle
    developers with a consistent way of handling geographic positions in OSGi
    applications. The <code>Position</code> class is intended to be used with
    the Wire Admin service but has wider applicability.</para>

    <para xml:id="i1271205">The <code>Position</code> class is designed to be
    compatible with the Global Positioning System (GPS). This specification
    will not define or explain the complexities of positioning information. It
    is assumed that the reader has the appropriate background to understand
    this information.</para>

    <section>
      <title>Essentials</title>

      <itemizedlist>
        <listitem>
          <para><emphasis>Position</emphasis> – Provide an information object
          that has well defined semantics for a position.</para>
        </listitem>

        <listitem>
          <para><emphasis>WGS-84</emphasis> – Use the World Geodetic System 84
          as the datum.</para>
        </listitem>

        <listitem>
          <para><emphasis>Speed</emphasis> – Provide speed and track
          information.</para>
        </listitem>

        <listitem>
          <para><emphasis>Errors</emphasis> – Position information always has
          certain errors or cannot be measured at all. This information must
          be available to the users of the information.</para>
        </listitem>

        <listitem>
          <para><emphasis>Units</emphasis> – Use SI units for all
          measurements.</para>
        </listitem>

        <listitem>
          <para><emphasis>Wire Admin</emphasis> – This specification must work
          within the Wire Admin service.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Entities</title>

      <itemizedlist>
        <listitem>
          <para><emphasis>Position</emphasis> – An object containing the
          different aspects of a position.</para>
        </listitem>

        <listitem>
          <para><emphasis>Measurement</emphasis> – Contains a typed
          measurement made at a certain time and with a specified
          error.</para>
        </listitem>
      </itemizedlist>

      <figure>
        <title>Class Diagram, org.osgi.util.position</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="1.221in"
                       contentwidth="4.922in" fileref="position-classes.svg"/>
          </imageobject>
        </mediaobject>
      </figure>
    </section>
  </section>

  <section>
    <title>Positioning</title>

    <para>The <code>Position</code> class is used to give information about
    the position and movement of a vehicle with a specified amount of
    uncertainty. The position is based on WGS-84.</para>

    <para>The Position class offers the following information:</para>

    <itemizedlist>
      <listitem>
        <para><xref linkend="org.osgi.util.position.Position.getLatitude--"/> – The WGS-84 latitude
        of the current position. The unit of a latitude must be rad
        (radians).</para>
      </listitem>

      <listitem>
        <para><xref linkend="org.osgi.util.position.Position.getLongitude--"/> – The WGS-84
        longitude of the current position. The unit of a longitude must be rad
        (radians).</para>
      </listitem>

      <listitem xml:id="i1271218">
        <para><xref linkend="org.osgi.util.position.Position.getAltitude--"/> – Altitude is
        expressed as height in meters above the WGS-84 ellipsoid. This value
        can differ from the actual height above mean sea level depending on
        the place on earth where the measurement is taken place. This value is
        not corrected for the geoid.</para>
      </listitem>

      <listitem>
        <para><xref linkend="org.osgi.util.position.Position.getTrack--"/> – The true north course
        of the vehicle in radians.</para>
      </listitem>

      <listitem>
        <para><xref linkend="org.osgi.util.position.Position.getSpeed--"/> – The ground speed. This
        speed must not include vertical speed.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Units</title>

    <para>Longitude and latitude are represented in radians, not degrees. This
    is consistent with the use of the <code>Measurement</code> object. Radians
    can be converted to degrees with the following formula, when
    <code>lonlat</code> is the longitude or latitude:</para>

    <programlisting>degrees = (lonlat / <symbol>π</symbol>) * 180</programlisting>

    <para>Calculation errors are significantly reduced when all calculations
    are done with a single unit system. This approach increases the complexity
    of presentation, but presentations are usually localized and require
    conversion anyway. Also, the radians are the units in the SI system and
    the java.lang.Math class uses only radians for angles.</para>
  </section>

  <section>
    <title>Optimizations</title>

    <para>A <code>Position</code> object must be immutable. It must remain its
    original values after it is created.</para>

    <para>The <code>Position</code> class is not final. This approach implies
    that developers are allowed to sub-class it and provide optimized
    implementations. For example, it is possible that the
    <code>Measurement</code> objects are only constructed when actually
    requested.</para>
  </section>

  <section>
    <title>Errors</title>

    <para>Positioning information is never exact. Even large errors can exist
    in certain conditions. For this reason, the <code>Position</code> class
    returns all its measurements as <code>Measurement</code> objects. The
    <code>Measurement</code> class maintains an error value for each
    measurement.</para>

    <para>In certain cases it is not possible to supply a value; in those
    cases, the method should return a <code>NaN</code> as specified in the
    <code>Measurement</code> class.</para>
  </section>

  <section>
    <title>Using Position With Wire Admin</title>

    <para xml:id="i1271250">The primary reason the Position is specified, is
    to use it with the <phrase role="xref">Wire Admin Service Specification on
    page 205</phrase>. A bundle that needs position information should
    register a Consumer service and the configuration should connect this
    service to an appropriate Producer service.</para>
  </section>

  <section>
    <title>Related Standards</title>

    <section xml:id="i1271252">
      <title>JSR 179</title>

      <para xml:id="i1271253">In JCP, started <xref
      linkend="i1255323" xrefstyle="Reference"/>. This API is
      targeted at embedded systems and is likely to not contain some of the
      features found in this API. This API is targeted to be reviewed at Q4 of
      2002. This API should be considered in a following release.</para>
    </section>
  </section>

  <section>
    <title>Security</title>

    <para>The security aspects of the <code>Position</code> class are
    delegated to the security aspects of the Wire Admin service. The
    <code>Position</code> object only carries the information. The Wire Admin
    service will define what Consumer services will receive position
    information from what Producer services. It is therefore up to the
    administrator of the Wire Admin service to assure that only trusted
    bundles receive this information, or can supply it.</para>
  </section>

  <xi:include href="../../generated/javadoc/docbook/org.osgi.util.position.xml"/>

  <section xml:id="util.position.references">
    <title>References</title>

    <para role="ExternalReference">World Geodetic System 84 (WGS-84)</para>

    <para
    role="ExternalReferenceCont">http://earth-info.nga.mil/GandG/publications/tr8350.2/tr8350_2.html</para>

    <para role="ExternalReference" xml:id="i1255323">Location API for
    J2ME</para>

    <para
    role="ExternalReferenceCont">http://www.jcp.org/jsr/detail/179.jsp</para>
  </section>
</chapter>
