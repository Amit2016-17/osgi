<?xml version="1.0" encoding="UTF-8"?>
<project name="project" default="publish">
	<target name="deploy" depends="master.deploy,javadoc,japitools,japicompat">
	</target>

	<target name="init" depends="master.init">
		<mkdir dir="${target}/japi"/>
	</target>

	<target name="javadoc" depends="init">
		<delete dir="${target}/javadoc"/>
		<echo>
			Project output: ${project.output}
			Sourcepath    : ${project.allsourcepath}
			Destdir       : ${target}/javadoc
		    Packages      : ${javadoc.packages}
			Bootcp        : ${repo}/ee.j2se/ee.j2se-1.5.0.jar, ${repo}/ee.foundation/ee.foundation-1.1.0.jar
			Classpath     : ${api.servlet}, ${api.jpa}, ${api.jaxp}
		</echo>
        <javadoc 
			access="protected" 
			windowtitle="OSGi Service Platform Release ${osgi.release} Version ${osgi.version}"
			author="false" 
			classpath="${project.output}"
			sourcepath="${project.allsourcepath}"
			destdir="${target}/javadoc" 
			nodeprecated="false" 
			nodeprecatedlist="false" 
			noindex="false" 
			nonavbar="false" 
			notree="false" 
			packagenames="${javadoc.packages}" 
			source="1.5" 
			splitindex="true" 
			use="true"
			version="false"
			encoding="UTF-8"
			docencoding="UTF-8"
			charset="UTF-8">
		    <bootclasspath>
      			<pathelement location="${repo}/ee.j2se/ee.j2se-1.5.0.jar"/>
      			<pathelement location="${repo}/ee.foundation/ee.foundation-1.1.0.jar"/>
    		</bootclasspath>
		    <classpath>
				<pathelement location="${api.servlet}" />
				<pathelement location="${api.jpa}" />
				<pathelement location="${api.jaxp}" />
    		</classpath>
			<tag name="Immutable" scope="types" description="Immutable"/>
			<tag name="ThreadSafe" scope="types" description="ThreadSafe"/>
			<tag name="NotThreadSafe" scope="types" description="NotThreadSafe"/>
			<tag name="GuardedBy" scope="methods,fields" description="Guarded By:"/>
			<header><![CDATA[<b>OSGi&trade; Service Platform</b><br/><font  size=-1>Release ${osgi.release} Version ${osgi.version}</font>]]></header>
			<bottom><![CDATA[<font size=-1>${copyright.html} Licensed under the <a href="{@docRoot}/LICENSE.html">OSGi Specification License, Version 1.0</a></font>]]></bottom>
			<doctitle><![CDATA[OSGi&trade; Service Platform Release ${osgi.release} Version ${osgi.version}]]></doctitle>
		</javadoc>
		<copy file="../osgi.companion/legal/OSGiSpecificationLicense-v10.html"
		    tofile="${target}/javadoc/LICENSE.html"
	    	verbose="${verbose}"
	      	preservelastmodified="true" />
		<zip destfile="${target}/javadoc.zip" basedir="${target}/javadoc"></zip>
    </target>
	
	<target name="japitools" depends="japitools.core,japitools.cmpn,japitools.mobile,japitools.enterprise,japitools.proposed,japitools.minimum,japitools.foundation">
	</target>

	<target name="japitools.core" depends="init">
		<echo>osgi.core ${project.workspace}/osgi.core/${target-dir}/osgi.core.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/osgi.core-latest.japi" />
			<arg value="packages" />
			<arg value="${repo}/ee.j2se/ee.j2se-1.5.0.jar" />
			<arg value="${project.workspace}/osgi.core/${target-dir}/osgi.core.jar" />
			<arg line="${japi.osgi.core}" />
		</java>
	</target>

	<target name="japitools.cmpn" depends="init">
		<echo>osgi.cmpn ${project.workspace}/osgi.cmpn/${target-dir}/osgi.cmpn.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/osgi.cmpn-latest.japi" />
			<arg value="packages" />
			<arg value="${repo}/ee.j2se/ee.j2se-1.5.0.jar" />
			<arg value="${repo}/ee.foundation/ee.foundation-1.1.0.jar" />
			<arg value="${project.workspace}/osgi.core/${target-dir}/osgi.core.jar" />
			<arg value="${project.workspace}/osgi.cmpn/${target-dir}/osgi.cmpn.jar" />
			<arg value="${api.servlet}" />
			<arg value="${api.jaxp}" />
			<arg line="${japi.osgi.cmpn}" />
		</java>
	</target>

	<target name="japitools.mobile" depends="init">
		<echo>osgi.mobile ${project.workspace}/osgi.mobile/${target-dir}/osgi.mobile.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/osgi.mobile-latest.japi" />
			<arg value="packages" />
			<arg value="${repo}/ee.j2se/ee.j2se-1.5.0.jar" />
			<arg value="${repo}/ee.foundation/ee.foundation-1.1.0.jar" />
			<arg value="${project.workspace}/osgi.core/${target-dir}/osgi.core.jar" />
			<arg value="${project.workspace}/osgi.mobile/${target-dir}/osgi.mobile.jar" />
			<arg value="${api.jaxp}" />
			<arg line="${japi.osgi.mobile}" />
		</java>
	</target>

	<target name="japitools.enterprise" depends="init">
		<echo>osgi.enterprise ${project.workspace}/osgi.enterprise/${target-dir}/osgi.enterprise.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/osgi.enterprise-latest.japi" />
			<arg value="packages" />
			<arg value="${repo}/ee.j2se/ee.j2se-1.5.0.jar" />
			<arg value="${project.workspace}/osgi.core/${target-dir}/osgi.core.jar" />
			<arg value="${project.workspace}/osgi.enterprise/${target-dir}/osgi.enterprise.jar" />
			<arg value="${api.servlet}" />
			<arg value="${api.jpa}" />
			<arg value="${api.jaxp}" />
			<arg line="${japi.osgi.enterprise}" />
		</java>
	</target>

	<target name="japitools.proposed" depends="init">
		<echo>osgi.proposed ${project.workspace}/osgi.proposed/${target-dir}/osgi.proposed.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/osgi.proposed-latest.japi" />
			<arg value="packages" />
			<arg value="${repo}/ee.j2se/ee.j2se-1.5.0.jar" />
			<arg value="${project.workspace}/osgi.core/${target-dir}/osgi.core.jar" />
			<arg value="${project.workspace}/osgi.proposed/${target-dir}/osgi.proposed.jar" />
			<arg value="${api.jaxp}" />
			<arg line="${japi.osgi.proposed}" />
		</java>
	</target>

	<target name="japitools.minimum" depends="init">
		<echo>ee.minimum ${project.workspace}/ee.minimum/${target-dir}/ee.minimum.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/ee.minimum-latest.japi" />
			<arg value="packages" />
			<arg value="${project.workspace}/ee.minimum/${target-dir}/ee.minimum.jar" />
			<arg value="+java" />
			<arg value="+javax" />
		</java>
	</target>

	<target name="japitools.foundation" depends="init">
		<echo>ee.foundation ${project.workspace}/ee.foundation/${target-dir}/ee.foundation.jar</echo>
		<java classname="net.wuffies.japi.Japize">
			<classpath path="${licensed}/japitools/share/java/japitools.jar" />
			<arg value="unzip" />
			<arg value="as" />
			<arg value="${target}/japi/ee.foundation-latest.japi" />
			<arg value="packages" />
			<arg value="${project.workspace}/ee.foundation/${target-dir}/ee.foundation.jar" />
			<arg value="+java" />
			<arg value="+javax" />
		</java>
	</target>

	<target name="japicompat" depends="japicompat.core,japicompat.cmpn,japicompat.mobile,japicompat.enterprise,japicompat.minimum,japicompat.foundation,japicompat.eecompare">
	</target>

	<target name="japicompat.core" depends="init">
		<echo>osgi.core</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.core-japicompat.html" />
			<arg value="${project.dir}/japi-published/osgi.core-published.japi" />
			<arg value="${target}/japi/osgi.core-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.core-changed-japicompat.html" />
			<arg value="${target}/japi/osgi.core-latest.japi" />
			<arg value="${project.dir}/japi-published/osgi.core-published.japi" />
		</exec>
	</target>

	<target name="japicompat.cmpn" depends="init">
		<echo>osgi.cmpn</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.cmpn-japicompat.html" />
			<arg value="${project.dir}/japi-published/osgi.cmpn-published.japi" />
			<arg value="${target}/japi/osgi.cmpn-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.cmpn-changed-japicompat.html" />
			<arg value="${target}/japi/osgi.cmpn-latest.japi" />
			<arg value="${project.dir}/japi-published/osgi.cmpn-published.japi" />
		</exec>
	</target>

	<target name="japicompat.mobile" depends="init">
		<echo>osgi.mobile</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.mobile-japicompat.html" />
			<arg value="${project.dir}/japi-published/osgi.mobile-published.japi" />
			<arg value="${target}/japi/osgi.mobile-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.mobile-changed-japicompat.html" />
			<arg value="${target}/japi/osgi.mobile-latest.japi" />
			<arg value="${project.dir}/japi-published/osgi.mobile-published.japi" />
		</exec>
	</target>

	<target name="japicompat.enterprise" depends="init">
		<echo>osgi.enterprise</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.enterprise-japicompat.html" />
			<arg value="${project.dir}/japi-published/osgi.enterprise-published.japi" />
			<arg value="${target}/japi/osgi.enterprise-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-v" />
			<arg value="-o" />
			<arg value="${target}/japi/osgi.enterprise-changed-japicompat.html" />
			<arg value="${target}/japi/osgi.enterprise-latest.japi" />
			<arg value="${project.dir}/japi-published/osgi.enterprise-published.japi" />
		</exec>
	</target>

	<target name="japicompat.minimum" depends="init">
		<echo>ee.minimum</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-o" />
			<arg value="${target}/japi/ee.minimum-japicompat.html" />
			<arg value="${project.dir}/japi-published/ee.minimum-published.japi" />
			<arg value="${target}/japi/ee.minimum-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-o" />
			<arg value="${target}/japi/ee.minimum-changed-japicompat.html" />
			<arg value="${target}/japi/ee.minimum-latest.japi" />
			<arg value="${project.dir}/japi-published/ee.minimum-published.japi" />
		</exec>
	</target>

	<target name="japicompat.foundation" depends="init">
		<echo>ee.foundation</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-o" />
			<arg value="${target}/japi/ee.foundation-japicompat.html" />
			<arg value="${project.dir}/japi-published/ee.foundation-published.japi" />
			<arg value="${target}/japi/ee.foundation-latest.japi" />
		</exec>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-o" />
			<arg value="${target}/japi/ee.foundation-changed-japicompat.html" />
			<arg value="${target}/japi/ee.foundation-latest.japi" />
			<arg value="${project.dir}/japi-published/ee.foundation-published.japi" />
		</exec>
	</target>

	<target name="japicompat.eecompare" depends="init">
		<echo>ee compare</echo>
		<exec executable="perl" failifexecutionfails="false">
			<arg value="${licensed}/japitools/bin/japicompat" />
			<arg value="-h" />
			<arg value="-o" />
			<arg value="${target}/japi/ee.minimum2foundation-japicompat.html" />
			<arg value="${target}/japi/ee.minimum-latest.japi" />
			<arg value="${target}/japi/ee.foundation-latest.japi" />
		</exec>
	</target>

	<target name="echo" depends="master.echo">
		<echo>companions:             ${companions}</echo>
		<echo>core.specs:             ${core.specs}</echo>
		<echo>cmpn.specs:             ${cmpn.specs}</echo>
		<echo>mobile.specs:           ${mobile.specs}</echo>
		<echo>enterprise.specs:       ${enterprise.specs}</echo>
		<echo>proposed.specs:         ${proposed.specs}</echo>
	</target>

	<import file="../cnf/build.xml" />
</project>
